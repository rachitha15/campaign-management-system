import { Search, Sun, Bell, LogOut, User } from "lucide-react";
import { Input } from "@/components/ui/input";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useToast } from "@/hooks/use-toast";

export default function Header() {
  const queryClient = useQueryClient();
  const { toast } = useToast();

  const logoutMutation = useMutation({
    mutationFn: async () => {
      const response = await fetch('/api/auth/logout', {
        method: 'POST',
        credentials: 'include'
      });
      if (!response.ok) {
        throw new Error('Logout failed');
      }
      return response.json();
    },
    onSuccess: () => {
      // Clear all cached data
      queryClient.clear();
      
      toast({
        title: "Logged out successfully",
        description: "All session data has been cleared.",
      });

      // Optionally reload the page to reset state
      window.location.reload();
    },
    onError: (error) => {
      toast({
        title: "Logout failed",
        description: error instanceof Error ? error.message : "An error occurred",
        variant: "destructive",
      });
    }
  });

  const handleLogout = () => {
    logoutMutation.mutate();
  };

  return (
    <header className="bg-white border-b border-gray-200 py-2 px-6 flex items-center justify-between">
      <div className="flex items-center">
        <div className="mr-8">
          <svg width="120" height="24" viewBox="0 0 120 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="h-8">
            <path d="M29.8906 7H32.8828L38.1328 18.2812H38.2969L43.5469 7H46.5391V22H44.1875V11.4766H44.0547L39.2344 22H37.1953L32.375 11.4766H32.2422V22H29.8906V7Z" fill="#072654"></path>
            <path d="M48.8281 22V7H57.3438C58.0521 7 58.7031 7.13021 59.2969 7.39062C59.8906 7.64583 60.4062 7.99479 60.8438 8.4375C61.2812 8.88021 61.625 9.39583 61.875 9.98438C62.125 10.5729 62.25 11.1823 62.25 11.8125C62.25 12.7396 62.0365 13.5573 61.6094 14.2656C61.1823 14.974 60.599 15.5156 59.8594 15.8906L63.0469 22H60.0781L57.2266 16.4062H51.2656V22H48.8281ZM51.2656 14.1562H57.25C57.6458 14.1562 58.0026 14.0651 58.3203 13.8828C58.638 13.7005 58.8932 13.4453 59.0859 13.1172C59.2786 12.7891 59.375 12.4141 59.375 11.9922C59.375 11.5599 59.2786 11.1797 59.0859 10.8516C58.8932 10.5234 58.6328 10.2682 58.3047 10.0859C57.9766 9.90365 57.6198 9.8125 57.2344 9.8125H51.2656V14.1562Z" fill="#072654"></path>
            <path d="M72.375 22.3281C71.2396 22.3281 70.2214 22.1302 69.3203 21.7344C68.4193 21.3385 67.6615 20.7917 67.0469 20.0938C66.4323 19.3958 65.9688 18.5833 65.6562 17.6562C65.3438 16.7292 65.1875 15.7396 65.1875 14.6875V14.3125C65.1875 13.1667 65.349 12.1094 65.6719 11.1406C65.9948 10.1719 66.4635 9.33333 67.0781 8.625C67.6927 7.91667 68.4375 7.36979 69.3125 6.98438C70.1875 6.59896 71.1667 6.40625 72.25 6.40625C73.3958 6.40625 74.401 6.61198 75.2656 7.02344C76.1302 7.4349 76.8359 8.01042 77.3828 8.75C77.9297 9.48958 78.3229 10.3542 78.5625 11.3438C78.8021 12.3333 78.9219 13.3958 78.9219 14.5312V15.8125H67.7344V13.4375H76.5469V13.1875C76.5156 12.4688 76.3646 11.8073 76.0938 11.2031C75.8229 10.599 75.4167 10.1146 74.875 9.75C74.3333 9.38542 73.6458 9.20312 72.8125 9.20312C72.1042 9.20312 71.4844 9.35417 70.9531 9.65625C70.4219 9.95833 69.9844 10.3802 69.6406 10.9219C69.2969 11.4635 69.0417 12.0885 68.875 12.7969C68.7083 13.5052 68.625 14.2656 68.625 15.0781V15.4531C68.625 16.1927 68.7344 16.8802 68.9531 17.5156C69.1719 18.151 69.4844 18.7031 69.8906 19.1719C70.2969 19.6406 70.7891 20.0052 71.3672 20.2656C71.9453 20.526 72.599 20.6562 73.3281 20.6562C74.2344 20.6562 75.0365 20.4844 75.7344 20.1406C76.4323 19.7969 77.0208 19.3125 77.5 18.6875L78.75 20.0938C78.4062 20.625 77.9479 21.1198 77.375 21.5781C76.8021 22.0365 76.1302 22.4036 75.3594 22.6797C74.5885 23.1119 73.5417 22.3281 72.375 22.3281Z" fill="#072654"></path>
            <path d="M80.9375 14.3125C80.9375 13.1042 81.1094 12 81.4531 11C81.7969 10 82.2891 9.13021 82.9297 8.39062C83.5703 7.65104 84.3385 7.07812 85.2344 6.67188C86.1302 6.26562 87.1302 6.0625 88.2344 6.0625C89.3385 6.0625 90.3333 6.26562 91.2188 6.67188C92.1042 7.07812 92.8698 7.64062 93.5156 8.36719C94.1615 9.09375 94.6562 9.95312 95 10.9453C95.3438 11.9375 95.5156 13.0365 95.5156 14.2422V14.6953C95.5156 15.9036 95.3438 17.0078 95 18.0078C94.6562 19.0078 94.1641 19.8776 93.5234 20.6172C92.8828 21.3568 92.1146 21.9297 91.2188 22.3359C90.3229 22.7422 89.3281 22.9453 88.2344 22.9453C87.1406 22.9453 86.1458 22.7422 85.25 22.3359C84.3542 21.9297 83.5885 21.3568 82.9531 20.6172C82.3177 19.8776 81.8281 19.0078 81.4844 18.0078C81.1406 17.0078 80.9688 16.0495 80.9688 15.0742V14.3125H80.9375ZM84.0938 14.6953C84.0938 15.3568 84.1667 15.9896 84.3125 16.5938C84.4583 17.1979 84.6823 17.7396 84.9844 18.2188C85.2865 18.6979 85.6693 19.0833 86.1328 19.375C86.5964 19.6667 87.1458 19.8125 87.7812 19.8125C88.4167 19.8125 88.9661 19.6667 89.4297 19.375C89.8932 19.0833 90.276 18.6979 90.5781 18.2188C90.8802 17.7396 91.1042 17.1979 91.25 16.5938C91.3958 15.9896 91.4688 15.3568 91.4688 14.6953V14.2422C91.4688 13.6016 91.3958 12.9896 91.25 12.4062C91.1042 11.8229 90.8776 11.2969 90.5703 10.8281C90.263 10.3594 89.8776 9.98438 89.4141 9.70312C88.9505 9.42188 88.401 9.28125 87.7656 9.28125C87.1302 9.28125 86.5833 9.42188 86.125 9.70312C85.6667 9.98438 85.2865 10.3542 84.9844 10.8125C84.6823 11.2708 84.4583 11.7969 84.3125 12.3906C84.1667 12.9844 84.0938 13.6016 84.0938 14.2422V14.6953Z" fill="#072654"></path>
            <path d="M103.812 6.40625C104.969 6.40625 105.984 6.61458 106.859 7.03125C107.734 7.44792 108.432 8.0625 108.953 8.875C109.474 9.6875 109.797 10.6953 109.922 11.8984H106.953C106.828 11.0755 106.536 10.4193 106.078 9.92969C105.62 9.44011 104.938 9.19531 104.031 9.19531C103.354 9.19531 102.781 9.375 102.312 9.73438C101.844 10.0938 101.484 10.6094 101.234 11.2812C100.985 11.9531 100.854 12.7604 100.844 13.7031V14.5625C100.844 15.5156 100.974 16.3333 101.234 17.0156C101.495 17.6979 101.865 18.2188 102.344 18.5781C102.823 18.9375 103.391 19.1172 104.047 19.1172C104.641 19.1172 105.146 19.0078 105.562 18.7891C105.979 18.5703 106.307 18.2552 106.547 17.8438C106.786 17.4323 106.933 16.9427 106.984 16.375H109.922C109.797 17.5052 109.479 18.487 108.969 19.3203C108.458 20.1536 107.771 20.7995 106.906 21.2578C106.042 21.7161 105.026 22.0651 103.859 21.9453C102.693 22.0651 101.683 21.8203 100.828 21.4141C99.9739 21.0078 99.2708 20.4505 98.7188 19.7422C98.1667 19.0339 97.7552 18.1953 97.4844 17.2266C97.2135 16.2578 97.0781 15.1953 97.0781 14.0391V13.6328C97.0781 12.4453 97.2135 11.3646 97.4844 10.3906C97.7552 9.41667 98.1719 8.57292 98.7344 7.85938C99.2969 7.14583 100 6.58854 100.844 6.1875C101.688 6.66667 102.688 6.40625 103.812 6.40625Z" fill="#072654"></path>
            <path d="M116.719 9.46875V22H112.953V6.71875H116.547L116.719 9.46875ZM116.078 13.0781H115.062C115.062 12.0365 115.229 11.112 115.562 10.3047C115.896 9.49739 116.357 8.82292 116.945 8.28125C117.534 7.73958 118.24 7.33333 119.062 7.0625C119.885 6.79167 120.797 6.65625 121.797 6.65625C122.609 6.65625 123.349 6.75521 124.016 6.95312C124.682 7.15104 125.25 7.46354 125.719 7.89062C126.188 8.31771 126.547 8.86458 126.797 9.53125C127.047 10.1979 127.172 11.0052 127.172 11.9531V22H123.375V11.9531C123.375 11.276 123.25 10.7656 123 10.4219C122.75 10.0781 122.411 9.83854 121.984 9.70312C121.557 9.56771 121.068 9.5 120.516 9.5C119.943 9.5 119.432 9.59896 118.984 9.79688C118.536 9.99479 118.156 10.2708 117.844 10.625C117.531 10.9792 117.292 11.3958 117.125 11.875C116.958 12.3542 116.875 12.8854 116.875 13.4688V13.0781H116.078Z" fill="#072654"></path>
            <path d="M132.625 17.1172L136.672 6.71875H140.656L134.062 22H131.156L124.578 6.71875H128.547L132.625 17.1172Z" fill="#072654"></path>
            <path d="M13.5781 1.54686C13.9219 0.734371 14.9375 0.359372 15.6094 0.109372C14.7031 -0.171878 13.6563 0.0781246 12.9688 0.765627C12.2813 1.45313 12.0313 2.5156 12.3438 3.42191H8.85938C9.17188 2.54686 9.90625 1.82819 10.7969 1.54686C9.875 1.07813 8.75 1.35936 8.14062 2.21876C7.53125 3.07816 7.65625 4.23446 8.40625 4.96883H7.42188C6.65625 4.96883 5.875 5.07819 5.125 5.31253C3.3125 5.89064 1.84375 7.17192 0.96875 8.87505C0.65625 9.57822 0.46875 10.3282 0.40625 11.1094C0.34375 11.8907 0.40625 12.675 0.5625 13.4376C1.21875 16.6719 4.125 19.0157 7.39062 19.0157H7.54688H18.0625C21.3438 19.0157 24 16.3594 24 13.0782C24 10.2188 21.9219 7.84377 19.1719 7.28127C18.6719 4.56252 16.2813 2.51566 13.5781 2.51566V3.4376C13.5781 2.7657 13.5781 2.2657 13.5781 1.54693V1.54686Z" fill="#072654"></path>
          </svg>
        </div>
        <div className="flex items-center space-x-8">
          <a href="#" className="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
              <path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd" />
            </svg>
            Payments
          </a>
          <a href="#" className="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
            </svg>
            Partners
          </a>
          <a href="#" className="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" />
            </svg>
            Banking
          </a>
          <a href="#" className="flex items-center text-gray-600 hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fillRule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clipRule="evenodd" />
            </svg>
            More
          </a>
        </div>
      </div>
      <div className="flex items-center space-x-4">
        <div className="relative">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <Search className="h-5 w-5 text-gray-400" />
          </div>
          <Input 
            type="text" 
            placeholder="Search payment products, settings, and more" 
            className="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary text-sm" 
            style={{ width: '300px' }}
          />
        </div>
        <button className="p-2 text-gray-600 hover:text-primary focus:outline-none">
          <Sun className="h-6 w-6" />
        </button>
        <button className="p-2 text-gray-600 hover:text-primary focus:outline-none">
          <Bell className="h-6 w-6" />
        </button>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <button className="rounded-full bg-gray-200 w-8 h-8 flex items-center justify-center text-gray-700 font-semibold hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
              GS
            </button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end" className="w-56">
            <DropdownMenuItem>
              <User className="mr-2 h-4 w-4" />
              <span>Profile</span>
            </DropdownMenuItem>
            <DropdownMenuItem 
              onClick={handleLogout}
              disabled={logoutMutation.isPending}
              className="text-red-600 focus:text-red-600"
            >
              <LogOut className="mr-2 h-4 w-4" />
              <span>{logoutMutation.isPending ? "Logging out..." : "Log out"}</span>
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
    </header>
  );
}
